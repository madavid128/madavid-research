---
permalink: /search.json
layout: null
---
{%- comment -%}
  Build-time search index for the global search overlay.
  - UI: _includes/global-search.html
  - JS: _scripts/global-search.js
  - This file must remain valid JSON (no comments below the front matter).
{%- endcomment -%}
[
  {%- assign first = true -%}

  {%- comment -%}
    Pages:
    - Include *all* titled pages (not just nav items) so search can find subpages.
    - Exclude non-content endpoints like /search.json and /404.html.
    - Allow opt-out via `search_exclude: true` in front matter.
  {%- endcomment -%}
  {%- assign all_pages = site.pages | where_exp: "p", "p.title and p.url" -%}
  {%- for p in all_pages -%}
    {%- if p.url == "/search.json" or p.url == "/404.html" -%}{%- continue -%}{%- endif -%}
    {%- if p.search_exclude == true -%}{%- continue -%}{%- endif -%}

    {%- assign url_parts = p.url | split: "/" -%}
    {%- assign top = url_parts[1] | default: "" -%}
    {%- assign p_type = "page" -%}
    {%- if top == "projects" -%}{%- assign p_type = "project" -%}{%- endif -%}
    {%- if top == "team" or top == "collaborators" -%}{%- assign p_type = "team" -%}{%- endif -%}
    {%- if top == "updates" -%}{%- assign p_type = "update" -%}{%- endif -%}
    {%- if top == "pictures" -%}{%- assign p_type = "picture" -%}{%- endif -%}
    {%- if top == "art" -%}{%- assign p_type = "art" -%}{%- endif -%}

    {%- assign p_desc = p.description | default: "" -%}
    {%- if p_desc == "" -%}
      {%- assign p_desc = p.content
        | default: ""
        | strip_html
        | strip_newlines
        | replace: "  ", " "
        | truncate: 200
      -%}
    {%- endif -%}

    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {
      "type": {{ p_type | jsonify }},
      "title": {{ p.title | jsonify }},
      "url": {{ p.url | relative_url | jsonify }},
      "description": {{ p_desc | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}Posts{%- endcomment -%}
  {%- for post in site.posts -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign excerpt = post.content
      | default: ""
      | regex_scan: "<!-- excerpt start -->(.*)<!-- excerpt end -->", true
      | default: post.excerpt
      | default: ""
      | strip_html
      | strip_newlines
    -%}
    {
      "type": "post",
      "title": {{ post.title | jsonify }},
      "url": {{ post.url | relative_url | jsonify }},
      "description": {{ excerpt | jsonify }},
      "date": {{ post.date | date_to_xmlschema | jsonify }},
      "tags": {{ post.tags | default: "" | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}Publications (citations){%- endcomment -%}
  {%- for c in site.data.citations -%}
    {%- unless c.title -%}{%- continue -%}{%- endunless -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign year = c.date | date: "%Y" -%}
    {%- capture author_str -%}{% if c.authors %}{{ c.authors | join: ", " }}{% endif %}{%- endcapture -%}
    {%- assign c_url = c.link | default: "research" -%}
    {%- if c_url contains "://" -%}
      {%- assign c_url_out = c_url -%}
    {%- else -%}
      {%- assign c_url_out = c_url | relative_url -%}
    {%- endif -%}
    {
      "type": "publication",
      "title": {{ c.title | jsonify }},
      "url": {{ c_url_out | jsonify }},
      "description": {{ author_str | strip_newlines | jsonify }},
      "year": {{ year | jsonify }},
      "id": {{ c.id | default: "" | jsonify }},
      "tags": {{ c.tags | default: "" | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}News{%- endcomment -%}
  {%- for n in site.data.news -%}
    {%- unless n.title -%}{%- continue -%}{%- endunless -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign n_url = n.link | default: "updates/#news" -%}
    {%- if n_url contains "://" -%}
      {%- assign n_url_out = n_url -%}
    {%- else -%}
      {%- assign n_url_out = n_url | relative_url -%}
    {%- endif -%}
    {
      "type": "news",
      "title": {{ n.title | jsonify }},
      "url": {{ n_url_out | jsonify }},
      "description": {{ n.description | default: n.source | default: "" | strip_html | strip_newlines | jsonify }},
      "date": {{ n.date | date_to_xmlschema | jsonify }},
      "tags": {{ n.tags | default: "" | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}Pictures{%- endcomment -%}
  {%- for g in site.data.pictures -%}
    {%- unless g.title -%}{%- continue -%}{%- endunless -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign q = g.title | uri_escape -%}
    {%- assign g_url_out = "pictures" | relative_url | append: "?search=" | append: q -%}
    {
      "type": "picture",
      "title": {{ g.title | jsonify }},
      "url": {{ g_url_out | jsonify }},
      "description": {{ g.subtitle | default: "" | jsonify }},
      "tags": {{ g.tags | default: "" | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}Scientific art{%- endcomment -%}
  {%- for g in site.data.art -%}
    {%- unless g.title -%}{%- continue -%}{%- endunless -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign q = g.title | uri_escape -%}
    {%- assign g_url_out = "art" | relative_url | append: "?search=" | append: q -%}
    {
      "type": "art",
      "title": {{ g.title | jsonify }},
      "url": {{ g_url_out | jsonify }},
      "description": {{ g.subtitle | default: "" | jsonify }},
      "tags": {{ g.tags | default: "" | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}People: collaborators{%- endcomment -%}
  {%- assign emptyarray = "" | split: "," -%}
  {%- assign collab_people = site.data.collaborators_map | default: emptyarray -%}
  {%- if collab_people == emptyarray and site.data.collaborators -%}
    {%- assign collab_people = site.data.collaborators -%}
  {%- endif -%}
  {%- for p in collab_people -%}
    {%- assign name = p.name | default: "" | strip -%}
    {%- if name == "" -%}{%- continue -%}{%- endif -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign q = name | uri_escape -%}
    {%- assign url_out = "collaborators" | relative_url | append: "?search=" | append: q -%}
    {%- capture desc -%}
      {%- if p.department and p.institution -%}{{ p.department }}, {{ p.institution }}
      {%- elsif p.institution -%}{{ p.institution }}
      {%- elsif p.department -%}{{ p.department }}
      {%- endif -%}
      {%- if p.first_year or p.last_year -%}
        {%- assign fy = p.first_year | default: "" | strip -%}
        {%- assign ly = p.last_year | default: "" | strip -%}
        {%- if fy != "" or ly != "" -%}
          {%- if fy != "" and ly != "" -%} ({{ fy }} to {{ ly }})
          {%- elsif fy != "" -%} ({{ fy }})
          {%- elsif ly != "" -%} ({{ ly }})
          {%- endif -%}
        {%- endif -%}
      {%- endif -%}
    {%- endcapture -%}
    {
      "type": "team",
      "title": {{ name | jsonify }},
      "url": {{ url_out | jsonify }},
      "description": {{ desc | strip_newlines | replace: "  ", " " | strip | jsonify }},
      "tags": {{ p.tags | default: "collaborator" | jsonify }}
    }
  {%- endfor -%}

  {%- comment -%}People: trainees{%- endcomment -%}
  {%- for t in site.data.trainees -%}
    {%- assign name = t.name | default: "" | strip -%}
    {%- if name == "" -%}{%- continue -%}{%- endif -%}
    {%- unless first -%},{%- endunless -%}
    {%- assign first = false -%}
    {%- assign q = name | uri_escape -%}
    {%- assign url_out = "team" | relative_url | append: "?search=" | append: q | append: "#trainees" -%}
    {%- capture desc -%}
      {%- if t.role -%}{{ t.role }}{%- endif -%}
      {%- if t.institution -%}{% if t.role %} · {% endif %}{{ t.institution }}{%- endif -%}
      {%- if t.start or t.end -%}
        {%- assign start = t.start | default: "" | strip -%}
        {%- assign end = t.end | default: "" | strip -%}
        {%- if start != "" or end != "" -%}
          {% if t.role or t.institution %} · {% endif %}
          {{ start }}{% if end != "" %} to {{ end }}{% endif %}
        {%- endif -%}
      {%- endif -%}
    {%- endcapture -%}
    {%- capture tags -%}trainee{% if t.tags %}; {{ t.tags | join: "; " }}{% endif %}{%- endcapture -%}
    {
      "type": "team",
      "title": {{ name | jsonify }},
      "url": {{ url_out | jsonify }},
      "description": {{ desc | strip_newlines | replace: "  ", " " | strip | jsonify }},
      "tags": {{ tags | jsonify }}
    }
  {%- endfor -%}
]
