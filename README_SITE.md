![on-push](../../actions/workflows/on-push.yaml/badge.svg)
![on-pull-request](../../actions/workflows/on-pull-request.yaml/badge.svg)
![on-schedule](../../actions/workflows/on-schedule.yaml/badge.svg)

# Michael A. David — Research Portfolio

This repository powers my personal research website (Jekyll + Lab Website Template).

- Live site: https://michaeladavid.com
- Repo: `madavid128/madavid-research`

My research integrates spatial histopathology, transcriptomics, and medical imaging using machine learning to study post‑traumatic musculoskeletal conditions (contracture and osteoarthritis).

## Local preview (Docker)

1) Start the local site:
- `bash .docker/run.sh`

2) View it:
- Open `http://localhost:4000`

3) Stop it:
- Press `Ctrl+C` in the terminal running Docker.

4) If it gets stuck, force restart:
- `docker rm -f lab-website-renderer`
- `bash .docker/run.sh`

Notes:
- Most edits (pages, `_data/*`, styles, scripts) are picked up automatically via hot reload.
- You only need to re-run Docker if the container is stopped or becomes unresponsive.
- Tip: on mobile, the nav closes automatically after you tap a link, and there’s a “back to top” button after scrolling.
- Tip: press `/` (or `Ctrl+K` / `⌘K`) on any page to open the global search overlay.
- Tip: if search results seem outdated, hard refresh (⌘⇧R / Ctrl+Shift+R) or restart Docker to rebuild `search.json`.

## Global search (header magnifying glass)

This site has a built-in search overlay (no Google dependency):
- Open it: click the magnifying glass, press `/`, or press `Ctrl+K` / `⌘K`
- It searches across: nav pages + subpages, projects, publications, news/blog items, pictures, and scientific art
- It’s powered by a build-time JSON index at `search.json` → served at `/search.json`

If you update `_data/citations.yaml`, `_data/news.yaml`, `_data/projects.yaml`, or add new pages, and search results don’t change:
- Restart the local Docker site (it rebuilds the Jekyll output)
- Or hard refresh your browser to bypass cached `/search.json`

## Social sharing preview (OpenGraph / iMessage / Slack)

Social previews use the OpenGraph image (`og:image` / `twitter:image`). This site is configured to use `images/share.jpg`.

To regenerate the share image from your MAD icon:
- `python tools/make_share_image.py --icon web-app-manifest-512x512.png`

Notes:
- If you change `_config.yaml` `url`/`baseurl`, the absolute `og:image` URL will change.
- Sharing apps often cache previews. If the image doesn’t update right away after a deploy, try sharing a different URL (e.g., add `?v=2`) or wait for the cache to expire.

## Blog posts

Blog posts live in `_posts/` and render under the **News/Blog** tab.

- Create a new post: `_posts/YYYY-MM-DD-title.md`
- Recommended front matter:
  - `title: ...`
  - `author: michael-david` (matches `_members/michael-david.md`)
  - `tags: [tag1, tag2]`
  - optional: `image: images/background.jpg`

## Publications + word cloud

The Publications page displays:
- the full publications list (`_data/citations.yaml`)
- a word cloud (`images/publications-wordcloud.png`)
- clickable “top terms” (`_data/publications_terms.yaml`)

These are generated by the citation pipeline (`python _cite/cite.py`) and by the GitHub Actions workflow `.github/workflows/update-citations.yaml`.

If you run the pipeline locally, set an email for NCBI requests:
- `export NCBI_EMAIL="you@domain.edu"`

## Collaborator map

The interactive collaborator map (on `team/` and `collaborators/`) is driven by `_data/collaborators_map.csv`.
Add one row per person/institution and include `lat`/`lon` (decimal degrees) for the marker to appear.

Recommended columns:
- `name` (required)
- `status` (`current` or `past`)
- `department`, `institution`, `city`, `region`, `country`
- `first_year`, `last_year` (enables the time slider)
- `lat`, `lon`
- `link` (absolute URL or site‑relative path like `contact`)
- `tags` (separate with `;`, e.g. `collaborator;institution`)
- optional: `papers`, `affiliation`, `institutions` (semicolon list)

### Update collaborators (manual CSV)

1) Edit `_data/collaborators_map.csv`
2) Ensure each row you want on the map has `lat` and `lon`
3) Refresh your local site (hot reload should pick it up; otherwise restart Docker)

### Bootstrap collaborators from PubMed (optional)

This writes `_data/collaborators_map.csv` (it does not change the Jekyll build logic).

1) Create a venv:
- `python3 -m venv .venv`
- `source .venv/bin/activate`

2) Install deps:
- `python -m pip install -r tools/requirements-collaborators.txt`

3) Build collaborator CSV from PubMed:
- `python tools/pubmed_to_collaborators_map.py --email you@domain.edu`

Notes:
- Rerunning preserves curated fields (status/tags/links/lat/lon) by default.
- To disable merging, pass `--no-merge-existing`.

4) Optional: geocode to fill `lat/lon` (rate limited / sometimes unavailable):
- `python tools/pubmed_to_collaborators_map.py --email you@domain.edu --geocode`

If geocoding fails with `HTTP Error 503`, retry later or increase retries:
- `python tools/pubmed_to_collaborators_map.py --email you@domain.edu --geocode --geocode-retries 10`

## Trainees map

The trainees map uses:
- `_data/trainees.yaml` (trainee entries with `start`/`end`, e.g. `April 2021`, `Present`)
- `_data/trainee_institutions.yaml` (institution → location + lat/lon)

The map UI includes a year slider and play button:
- **Active**: shows trainees active in that year
- **To date**: shows trainees who have started by that year (ended trainees display as “Past”)

On `collaborators/` and `team/`, directories also have a **Table** view (sortable) for fast scanning.

## Galleries (Pictures / Scientific Art)

`pictures/` and `art/` use a lightweight gallery + lightbox:
- Data: `_data/pictures.yaml`, `_data/art.yaml`
- Rendering: `_includes/gallery.html`
- JS: `_scripts/gallery.js`
- Styles: `_styles/gallery.scss`

Replace placeholder SVGs under `images/` with real images (JPG/PNG/WebP) and update the corresponding `_data/*.yaml` entries.

### Optional: generate WebP variants

If you add JPG/PNG photos, you can optionally generate `.webp` variants (served automatically when present):

- Install Pillow: `python -m pip install Pillow`
- Run: `python tools/make_webp.py images`

## Manual publications (e.g., dissertation)

If an item is not on PubMed, add it to `_data/sources.yaml`. The cite pipeline will include it alongside automated sources without affecting PubMed/ORCID ingestion.

## Icons

The site uses Font Awesome classes for most icons (see `_data/types.yaml` and per‑page `nav.icon` front matter).

### Generate a full icon set (static PNG/ICO/SVG + animated GIFs)

`make_mad_icons.py` reads `web-app-manifest-512x512.png` and generates:
- PNGs: `apple-touch-icon.png`, `favicon-96x96.png`, `web-app-manifest-192x192.png`, `web-app-manifest-512x512.png`
- `favicon.ico` (16/32/48/64)
- `favicon.svg` (wrapper pointing at `web-app-manifest-512x512.png`)
- Animated GIFs (electric‑sign effect) at multiple sizes
- A zip bundle `MAD_icons.zip` (generated; ignored by git)

1) Create a venv (if you don’t already have one):
- `python3 -m venv .venv`
- `source .venv/bin/activate`

2) Install Pillow:
- `python -m pip install Pillow`

3) Run:
- `python make_mad_icons.py`

Outputs:
- `dist_icons/` (generated files; ignored by git)
- `MAD_icons.zip` (generated; ignored by git)

To apply the **static** icons to the website, copy these from `dist_icons/` to the repo root (overwrite existing):
- `apple-touch-icon.png`
- `favicon-96x96.png`
- `favicon.ico`
- `favicon.svg`
- `web-app-manifest-192x192.png`
- `web-app-manifest-512x512.png`

Animated favicon support varies by browser. The GIFs will always work as normal images on pages, but may not animate in the browser tab.

## Background image (network style)

To generate a dark abstract “network” header background (teal/green nodes + lines):
- `python tools/make_network_background.py`

Default output:
- `images/background.jpg` (2400×1350)

Useful options:
- `python tools/make_network_background.py --width 1920 --height 1080`
- `python tools/make_network_background.py --seed 128` (deterministic)

## Licensing notes

The repository’s default license is `LICENSE.md` (BSD 3‑Clause).

Some standalone helper scripts are MIT‑licensed (see `licenses/MIT_FOR_HELPERS.md`) and marked per-file with `SPDX-License-Identifier: MIT`. See `LICENSES.md` for the current list.

_Built with [Lab Website Template](https://greene-lab.gitbook.io/lab-website-template-docs)._
